<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Borren Zarabodrio</title>

  <style>
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#c0b1b1;
      color:#efd7d7;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .wrap{
      width:100%;
      max-width:600px;
      text-align:center;
      padding:20px;
    }
    h1{
      font-size:48px;
      margin:0 0 10px;
      letter-spacing:1px;
    }
    p{
      margin:0 0 14px;
      font-size:18px;
    }
    .count{
      margin-bottom:24px;
      font-size:16px;
      opacity:.8;
    }
    button{
      background:none;
      border:1px solid #555;
      color:#fff;
      padding:12px 16px;
      margin:6px;
      font-size:16px;
      cursor:pointer;
    }
    canvas{
      width:100%;
      height:200px;
      border:1px dashed #555;
      margin:20px 0;
      touch-action:none;
    }
    .hidden{ display:none; }
  </style>
</head>

<body>
  <main class="wrap">
    <h1>BORREN ZARABODRIO</h1>
    <p>VOTA PARA BORRAR ZARABODRIO</p>
    <div class="count">HAN FIRMADO: <span id="count">0</span></div>

    <section id="start">
      <button id="btnFirmar">FIRMAR</button>
    </section>

    <section id="sign" class="hidden">
      <canvas id="canvas"></canvas>
      <button id="btnEnviar">ENVIAR</button>
      <button id="btnCancelar">ME ARREPIENTO</button>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "borren_zarabodrio_firmas";

    const countEl = document.getElementById("count");
    const start = document.getElementById("start");
    const sign  = document.getElementById("sign");

    const btnFirmar  = document.getElementById("btnFirmar");
    const btnEnviar  = document.getElementById("btnEnviar");
    const btnCancelar= document.getElementById("btnCancelar");

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let drawing = false;
    let hasInk = false;
    let last = {x:0,y:0};

    function getCount(){
      return Number(localStorage.getItem(STORAGE_KEY) || 0);
    }

    function setCount(n){
      localStorage.setItem(STORAGE_KEY, n);
      countEl.textContent = n;
    }

    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.lineWidth = 3;
      ctx.lineCap = "round";
      ctx.strokeStyle = "#fff";
    }

    function clearCanvas(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      hasInk = false;
    }

    function pos(e){
      const r = canvas.getBoundingClientRect();
      const t = e.touches && e.touches[0];
      return {
        x:(t?t.clientX:e.clientX)-r.left,
        y:(t?t.clientY:e.clientY)-r.top
      };
    }

    canvas.addEventListener("mousedown", e=>{
      drawing=true; last=pos(e);
    });
    canvas.addEventListener("mousemove", e=>{
      if(!drawing) return;
      const p = pos(e);
      ctx.beginPath();
      ctx.moveTo(last.x,last.y);
      ctx.lineTo(p.x,p.y);
      ctx.stroke();
      last=p;
      hasInk=true;
    });
    window.addEventListener("mouseup", ()=>drawing=false);

    canvas.addEventListener("touchstart", e=>{
      drawing=true; last=pos(e); e.preventDefault();
    },{passive:false});
    canvas.addEventListener("touchmove", e=>{
      if(!drawing) return;
      const p = pos(e);
      ctx.beginPath();
      ctx.moveTo(last.x,last.y);
      ctx.lineTo(p.x,p.y);
      ctx.stroke();
      last=p;
      hasInk=true;
      e.preventDefault();
    },{passive:false});
    canvas.addEventListener("touchend", ()=>drawing=false);

    btnFirmar.onclick = ()=>{
      start.classList.add("hidden");
      sign.classList.remove("hidden");
      resizeCanvas();
      clearCanvas();
    };

    btnCancelar.onclick = ()=>{
      sign.classList.add("hidden");
      start.classList.remove("hidden");
      clearCanvas();
    };

    btnEnviar.onclick = ()=>{
      if(!hasInk){
        alert("FIRMA PRIMERO");
        return;
      }
      setCount(getCount()+1);
      sign.classList.add("hidden");
      start.classList.remove("hidden");
      clearCanvas();
    };

    setCount(getCount());
  </script>
</body>
</html>

